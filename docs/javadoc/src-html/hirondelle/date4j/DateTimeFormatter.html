<HTML>
 <HEAD>
  <TITLE>
DateTimeFormatter.java
  </TITLE>
  <LINK REL ='stylesheet' TYPE='text/css' HREF='../../../highlight.css' TITLE='Style'>
 </HEAD>
 <BODY>
<PRE>
<span class='keyword'>package</span> hirondelle.date4j;<a name=line.1></a>
<a name=line.2></a>
<span class='keyword'>import</span> java.text.SimpleDateFormat;<a name=line.3></a>
<span class='keyword'>import</span> java.util.ArrayList;<a name=line.4></a>
<span class='keyword'>import</span> java.util.Calendar;<a name=line.5></a>
<span class='keyword'>import</span> java.util.Collection;<a name=line.6></a>
<span class='keyword'>import</span> java.util.GregorianCalendar;<a name=line.7></a>
<span class='keyword'>import</span> java.util.LinkedHashMap;<a name=line.8></a>
<span class='keyword'>import</span> java.util.List;<a name=line.9></a>
<span class='keyword'>import</span> java.util.Locale;<a name=line.10></a>
<span class='keyword'>import</span> java.util.Map;<a name=line.11></a>
<span class='keyword'>import</span> java.util.regex.Matcher;<a name=line.12></a>
<span class='keyword'>import</span> java.util.regex.Pattern;<a name=line.13></a>
<a name=line.14></a>
<span class='comment'>/**<a name=line.15></a>
 Formats a {@link DateTime}, and implements {@link DateTime#format(String)}.<a name=line.16></a>
 <a name=line.17></a>
 &lt;P&gt;This class defines a mini-language for defining how a {@link DateTime} is formatted.<a name=line.18></a>
 See {@link DateTime#format(String)} for details regarding the formatting mini-language.<a name=line.19></a>
<a name=line.20></a>
 &lt;P&gt;The DateFormatSymbols class might be used to grab the locale-specific text, but the arrays it <a name=line.21></a>
 returns are wonky and weird, so I have avoided it.<a name=line.22></a>
*/</span><a name=line.23></a>
<span class='keyword'>final</span> <span class='keyword'>class</span> DateTimeFormatter {<a name=line.24></a>
<a name=line.25></a>
  <span class='comment'>/**<a name=line.26></a>
   Constructor used for patterns that represent date-time elements using only numbers, and no localizable text. <a name=line.27></a>
   @param aFormat uses the syntax described by {@link DateTime#format(String)}.<a name=line.28></a>
   */</span><a name=line.29></a>
  DateTimeFormatter(String aFormat){<a name=line.30></a>
    fFormat = aFormat;<a name=line.31></a>
    fLocale = <span class='keyword'>null</span>;<a name=line.32></a>
    fCustomLocalization = <span class='keyword'>null</span>;<a name=line.33></a>
    validateState();<a name=line.34></a>
  }<a name=line.35></a>
<a name=line.36></a>
  <span class='comment'>/**<a name=line.37></a>
   Constructor used for patterns that represent date-time elements using not only numbers, but text as well. <a name=line.38></a>
   The text needs to be localizable.<a name=line.39></a>
   @param aFormat uses the syntax described by {@link DateTime#format(String)}.<a name=line.40></a>
   @param aLocale used to generate text for Month, Weekday, and AM-PM indicator; required only by patterns which return localized <a name=line.41></a>
   text, instead of numeric forms for date-time elements.<a name=line.42></a>
   */</span><a name=line.43></a>
  DateTimeFormatter(String aFormat, Locale aLocale){<a name=line.44></a>
    fFormat = aFormat;<a name=line.45></a>
    fLocale = aLocale;<a name=line.46></a>
    fCustomLocalization = <span class='keyword'>null</span>;<a name=line.47></a>
    validateState();<a name=line.48></a>
  }<a name=line.49></a>
<a name=line.50></a>
  <span class='comment'>/**<a name=line.51></a>
   Constructor used for patterns that represent using not only numbers, but customized text as well. <a name=line.52></a>
   <a name=line.53></a>
   &lt;P&gt;This constructor exists mostly since SimpleDateFormat doesn't support all locales, and it has a <a name=line.54></a>
   policy of N letters for text, where N != 3. <a name=line.55></a>
<a name=line.56></a>
   @param aFormat must match the syntax described by {@link DateTime#format(String)}.<a name=line.57></a>
   @param aMonths contains text for all 12 months, starting with January; size must be 12. <a name=line.58></a>
   @param aWeekdays contains text for all 7 weekdays, starting with Sunday; size must be 7. <a name=line.59></a>
   @param aAmPmIndicators contains text for A.M and P.M. indicators (in that order); size must be 2. <a name=line.60></a>
   */</span><a name=line.61></a>
  DateTimeFormatter(String aFormat, List&lt;String&gt; aMonths, List&lt;String&gt; aWeekdays, List&lt;String&gt; aAmPmIndicators){<a name=line.62></a>
    fFormat = aFormat;<a name=line.63></a>
    fLocale = <span class='keyword'>null</span>;<a name=line.64></a>
    fCustomLocalization = <span class='keyword'>new</span> CustomLocalization(aMonths, aWeekdays, aAmPmIndicators);<a name=line.65></a>
    validateState();<a name=line.66></a>
  }<a name=line.67></a>
  <a name=line.68></a>
  <span class='comment'>/**  Format a {@link DateTime}.  */</span><a name=line.69></a>
  String format(DateTime aDateTime){<a name=line.70></a>
    fEscapedRanges = <span class='keyword'>new</span> ArrayList&lt;EscapedRange&gt;();<a name=line.71></a>
    fInterpretedRanges = <span class='keyword'>new</span> ArrayList&lt;InterpretedRange&gt;();<a name=line.72></a>
    findEscapedRanges();<a name=line.73></a>
    interpretInput(aDateTime);<a name=line.74></a>
    <span class='keyword'>return</span> produceFinalOutput();<a name=line.75></a>
  }<a name=line.76></a>
  <a name=line.77></a>
  <span class='comment'>// PRIVATE <a name=line.78></a>
</span>  <span class='keyword'>private</span> <span class='keyword'>final</span> String fFormat;<a name=line.79></a>
  <span class='keyword'>private</span> <span class='keyword'>final</span> Locale fLocale;<a name=line.80></a>
  <span class='keyword'>private</span> Collection&lt;InterpretedRange&gt; fInterpretedRanges;<a name=line.81></a>
  <span class='keyword'>private</span> Collection&lt;EscapedRange&gt; fEscapedRanges;<a name=line.82></a>
  <a name=line.83></a>
   <span class='comment'>/** <a name=line.84></a>
    Table mapping a Locale to the names of the months.<a name=line.85></a>
    Initially empty, populated only when a specific Locale is needed for presenting such text. <a name=line.86></a>
    Used for MMMM and MMM tokens.  <a name=line.87></a>
  */</span><a name=line.88></a>
  <span class='keyword'>private</span> <span class='keyword'>final</span> Map&lt;Locale, List&lt;String&gt;&gt; fMonths = <span class='keyword'>new</span> LinkedHashMap&lt;Locale, List&lt;String&gt;&gt;();<a name=line.89></a>
   <a name=line.90></a>
   <span class='comment'>/** <a name=line.91></a>
   Table mapping a Locale to the names of the weekdays.<a name=line.92></a>
   Initially empty, populated only when a specific Locale is needed for presenting such text. <a name=line.93></a>
   Used for WWWW and WWW tokens.  <a name=line.94></a>
  */</span><a name=line.95></a>
  <span class='keyword'>private</span> <span class='keyword'>final</span> Map&lt;Locale, List&lt;String&gt;&gt; fWeekdays = <span class='keyword'>new</span> LinkedHashMap&lt;Locale, List&lt;String&gt;&gt;();<a name=line.96></a>
   <a name=line.97></a>
   <span class='comment'>/**<a name=line.98></a>
    Table mapping a Locale to the text used to indicate a.m. and p.m. <a name=line.99></a>
    Initially empty, populated only when a specific Locale is needed for presenting such text. <a name=line.100></a>
    Used for the 'a' token.  <a name=line.101></a>
  */</span><a name=line.102></a>
  <span class='keyword'>private</span> <span class='keyword'>final</span> Map&lt;Locale, List&lt;String&gt;&gt; fAmPm = <span class='keyword'>new</span> LinkedHashMap&lt;Locale, List&lt;String&gt;&gt;();<a name=line.103></a>
  <a name=line.104></a>
  <span class='keyword'>private</span> <span class='keyword'>final</span> CustomLocalization fCustomLocalization;<a name=line.105></a>
  <a name=line.106></a>
  <span class='keyword'>private</span> <span class='keyword'>final</span> <span class='keyword'>class</span> CustomLocalization{<a name=line.107></a>
    CustomLocalization(List&lt;String&gt; aMonths, List&lt;String&gt; aWeekdays, List&lt;String&gt; aAmPm){<a name=line.108></a>
      <span class='keyword'>if</span>(aMonths.size() != <span class='literal'>12</span>){<a name=line.109></a>
        <span class='keyword'>throw</span> <span class='keyword'>new</span> IllegalArgumentException(<span class='literal'>"Your List of custom months must have size 12, but its size is "</span> + aMonths.size());<a name=line.110></a>
      }<a name=line.111></a>
      <span class='keyword'>if</span>(aWeekdays.size() != <span class='literal'>7</span>){<a name=line.112></a>
        <span class='keyword'>throw</span> <span class='keyword'>new</span> IllegalArgumentException(<span class='literal'>"Your List of custom weekdays must have size 7, but its size is "</span> + aWeekdays.size());<a name=line.113></a>
      }<a name=line.114></a>
      <span class='keyword'>if</span>(aAmPm.size() != <span class='literal'>2</span>){<a name=line.115></a>
        <span class='keyword'>throw</span> <span class='keyword'>new</span> IllegalArgumentException(<span class='literal'>"Your List of custom a.m./p.m. indicators must have size 2, but its size is "</span> + aAmPm.size());<a name=line.116></a>
      }<a name=line.117></a>
      Months = aMonths;<a name=line.118></a>
      Weekdays = aWeekdays;<a name=line.119></a>
      AmPmIndicators = aAmPm;<a name=line.120></a>
    }<a name=line.121></a>
    List&lt;String&gt; Months;<a name=line.122></a>
    List&lt;String&gt; Weekdays;<a name=line.123></a>
    List&lt;String&gt; AmPmIndicators;<a name=line.124></a>
  }<a name=line.125></a>
<a name=line.126></a>
  <span class='comment'>/** A section of fFormat containing a token that must be interpreted. */</span> <a name=line.127></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> <span class='keyword'>class</span> InterpretedRange {<a name=line.128></a>
    <span class='keyword'>int</span> Start; <a name=line.129></a>
    <span class='keyword'>int</span> End;<a name=line.130></a>
    String Text;<a name=line.131></a>
    <span class='keyword'>@Override</span> <span class='keyword'>public</span> String toString(){ <span class='keyword'>return</span> <span class='literal'>"Start:"</span> + Start + <span class='literal'>" End:"</span> + End + <span class='literal'>" '"</span> + Text + <span class='literal'>"'"</span>;};<a name=line.132></a>
  }<a name=line.133></a>
  <a name=line.134></a>
  <span class='comment'>/** A section of fFormat bounded by a pair of escape characters; such ranges contain uninterpreted text. */</span><a name=line.135></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> <span class='keyword'>class</span> EscapedRange {<a name=line.136></a>
    <span class='keyword'>int</span> Start;<a name=line.137></a>
    <span class='keyword'>int</span> End;<a name=line.138></a>
  }<a name=line.139></a>
<a name=line.140></a>
  <span class='comment'>/** Special character used to escape the interpretation of parts of fFormat. */</span><a name=line.141></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String ESCAPE_CHAR = <span class='literal'>"|"</span>;<a name=line.142></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> Pattern ESCAPED_RANGE = Pattern.compile(<span class='literal'>"&#092;&#092;|[^&#092;&#092;|]*&#092;&#092;|"</span>);<a name=line.143></a>
  <a name=line.144></a>
  <span class='comment'>/* Here, 'token' means an item in the mini-language, having special meaning (defined below). */</span> <a name=line.145></a>
  <a name=line.146></a>
  <span class='comment'>//all date-related tokens are in upper case<a name=line.147></a>
</span>  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String YYYY = <span class='literal'>"YYYY"</span>;<a name=line.148></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String YY = <span class='literal'>"YY"</span>;<a name=line.149></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String M = <span class='literal'>"M"</span>;<a name=line.150></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String MM = <span class='literal'>"MM"</span>;<a name=line.151></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String MMM = <span class='literal'>"MMM"</span>;<a name=line.152></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String MMMM = <span class='literal'>"MMMM"</span>;<a name=line.153></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String D = <span class='literal'>"D"</span>;<a name=line.154></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String DD = <span class='literal'>"DD"</span>;<a name=line.155></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String WWW = <span class='literal'>"WWW"</span>;<a name=line.156></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String WWWW = <span class='literal'>"WWWW"</span>;<a name=line.157></a>
  <a name=line.158></a>
  <span class='comment'>//all time-related tokens are in lower case<a name=line.159></a>
</span>  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String hh = <span class='literal'>"hh"</span>;<a name=line.160></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String h = <span class='literal'>"h"</span>;<a name=line.161></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String m = <span class='literal'>"m"</span>;<a name=line.162></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String mm = <span class='literal'>"mm"</span>;<a name=line.163></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String s = <span class='literal'>"s"</span>;<a name=line.164></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String ss = <span class='literal'>"ss"</span>;<a name=line.165></a>
  <a name=line.166></a>
  <span class='comment'>/**<a name=line.167></a>
   The 12-hour clock style.<a name=line.168></a>
    <a name=line.169></a>
   12:00 am is midnight, 12:30am is 30 minutes past midnight, 12:00 pm is 12 noon.<a name=line.170></a>
   This item is almost always used with 'a' to indicate am/pm.  <a name=line.171></a>
  */</span><a name=line.172></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String h12 = <span class='literal'>"h12"</span>;<a name=line.173></a>
  <a name=line.174></a>
  <span class='comment'>/** As {@link #h12}, but with leading zero. */</span> <a name=line.175></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String hh12 = <span class='literal'>"hh12"</span>;<a name=line.176></a>
<a name=line.177></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> <span class='keyword'>int</span> AM = <span class='literal'>0</span>; <span class='comment'>//a.m. comes first in lists used by this class <a name=line.178></a>
</span>  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> <span class='keyword'>int</span> PM = <span class='literal'>1</span>;<a name=line.179></a>
  <a name=line.180></a>
  <span class='comment'>/**<a name=line.181></a>
   A.M./P.M. text is sensitive to Locale, in the same way that names of months and weekdays are <a name=line.182></a>
   sensitive to Locale.  <a name=line.183></a>
  */</span><a name=line.184></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String a = <span class='literal'>"a"</span>; <a name=line.185></a>
  <a name=line.186></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> Pattern FRACTIONALS = Pattern.compile(<span class='literal'>"f{1,9}"</span>);<a name=line.187></a>
  <a name=line.188></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> String EMPTY_STRING = <span class='literal'>""</span>;<a name=line.189></a>
  <a name=line.190></a>
  <span class='comment'>/** <a name=line.191></a>
   The order of these items is significant, and is critical for how fFormat is interpreted.<a name=line.192></a>
   The 'longer' tokens must come first, in any group of related tokens. <a name=line.193></a>
  */</span><a name=line.194></a>
  <span class='keyword'>private</span> <span class='keyword'>static</span> <span class='keyword'>final</span> List&lt;String&gt; TOKENS = <span class='keyword'>new</span> ArrayList&lt;String&gt;();<a name=line.195></a>
  <span class='keyword'>static</span> {<a name=line.196></a>
    TOKENS.add(YYYY);<a name=line.197></a>
    TOKENS.add(YY);<a name=line.198></a>
    TOKENS.add(MMMM);<a name=line.199></a>
    TOKENS.add(MMM);<a name=line.200></a>
    TOKENS.add(MM);<a name=line.201></a>
    TOKENS.add(M);<a name=line.202></a>
    TOKENS.add(DD);<a name=line.203></a>
    TOKENS.add(D);<a name=line.204></a>
    TOKENS.add(WWWW);<a name=line.205></a>
    TOKENS.add(WWW);<a name=line.206></a>
    TOKENS.add(hh12);<a name=line.207></a>
    TOKENS.add(h12);<a name=line.208></a>
    TOKENS.add(hh);<a name=line.209></a>
    TOKENS.add(h);<a name=line.210></a>
    TOKENS.add(mm);<a name=line.211></a>
    TOKENS.add(m);<a name=line.212></a>
    TOKENS.add(ss);<a name=line.213></a>
    TOKENS.add(s);<a name=line.214></a>
    TOKENS.add(a);<a name=line.215></a>
    <span class='comment'>//should these be constants too?<a name=line.216></a>
</span>    TOKENS.add(<span class='literal'>"fffffffff"</span>);<a name=line.217></a>
    TOKENS.add(<span class='literal'>"ffffffff"</span>);<a name=line.218></a>
    TOKENS.add(<span class='literal'>"fffffff"</span>);<a name=line.219></a>
    TOKENS.add(<span class='literal'>"ffffff"</span>);<a name=line.220></a>
    TOKENS.add(<span class='literal'>"fffff"</span>);<a name=line.221></a>
    TOKENS.add(<span class='literal'>"ffff"</span>);<a name=line.222></a>
    TOKENS.add(<span class='literal'>"fff"</span>);<a name=line.223></a>
    TOKENS.add(<span class='literal'>"ff"</span>);<a name=line.224></a>
    TOKENS.add(<span class='literal'>"f"</span>);<a name=line.225></a>
  }<a name=line.226></a>
<a name=line.227></a>
  <span class='comment'>/** Escaped ranges are bounded by a PAIR of {@link #ESCAPE_CHAR} characters. */</span><a name=line.228></a>
  <span class='keyword'>private</span> <span class='keyword'>void</span> findEscapedRanges(){<a name=line.229></a>
    Matcher matcher = ESCAPED_RANGE.matcher(fFormat);<a name=line.230></a>
    <span class='keyword'>while</span> (matcher.find()){<a name=line.231></a>
      EscapedRange escapedRange = <span class='keyword'>new</span> EscapedRange();<a name=line.232></a>
      escapedRange.Start = matcher.start(); <span class='comment'>//first pipe<a name=line.233></a>
</span>      escapedRange.End = matcher.end() - <span class='literal'>1</span>; <span class='comment'>//second pipe<a name=line.234></a>
</span>      fEscapedRanges.add(escapedRange);<a name=line.235></a>
    }<a name=line.236></a>
  }<a name=line.237></a>
  <a name=line.238></a>
  <span class='comment'>/** Return true only if the start of the interpreted range is in an escaped range. */</span> <a name=line.239></a>
  <span class='keyword'>private</span> <span class='keyword'>boolean</span> isInEscapedRange(InterpretedRange aInterpretedRange){<a name=line.240></a>
    <span class='keyword'>boolean</span> result = <span class='keyword'>false</span>; <span class='comment'>//innocent till shown guilty<a name=line.241></a>
</span>    <span class='keyword'>for</span>(EscapedRange escapedRange : fEscapedRanges){<a name=line.242></a>
      <span class='comment'>//checking only the start is sufficient, because the tokens never contain the escape char<a name=line.243></a>
</span>      <span class='keyword'>if</span>(escapedRange.Start <= aInterpretedRange.Start &amp;&amp; aInterpretedRange.Start <= escapedRange.End ){<a name=line.244></a>
        result = <span class='keyword'>true</span>;<a name=line.245></a>
        <span class='keyword'>break</span>;<a name=line.246></a>
      }<a name=line.247></a>
    }<a name=line.248></a>
    <span class='keyword'>return</span> result;<a name=line.249></a>
  }<a name=line.250></a>
  <a name=line.251></a>
  <span class='comment'>/** <a name=line.252></a>
   Scan fFormat for all tokens, in a specific order, and interpret them with the given DateTime. <a name=line.253></a>
   The interpreted tokens are saved for output later. <a name=line.254></a>
  */</span><a name=line.255></a>
  <span class='keyword'>private</span> <span class='keyword'>void</span> interpretInput(DateTime aDateTime){<a name=line.256></a>
    String format = fFormat;<a name=line.257></a>
    <span class='keyword'>for</span>(String token : TOKENS){<a name=line.258></a>
      Pattern pattern = Pattern.compile(token);<a name=line.259></a>
      Matcher matcher = pattern.matcher(format);<a name=line.260></a>
      <span class='keyword'>while</span>(matcher.find()){<a name=line.261></a>
        InterpretedRange interpretedRange = <span class='keyword'>new</span> InterpretedRange();<a name=line.262></a>
        interpretedRange.Start = matcher.start();<a name=line.263></a>
        interpretedRange.End = matcher.end() - <span class='literal'>1</span>;<a name=line.264></a>
        <span class='keyword'>if</span>(! isInEscapedRange(interpretedRange)){<a name=line.265></a>
          interpretedRange.Text = interpretThe(matcher.group(), aDateTime);<a name=line.266></a>
          fInterpretedRanges.add(interpretedRange);<a name=line.267></a>
        }<a name=line.268></a>
      }<a name=line.269></a>
      format = format.replace(token, withCharDenotingAlreadyInterpreted(token));<a name=line.270></a>
    }<a name=line.271></a>
  }<a name=line.272></a>
  <a name=line.273></a>
  <span class='comment'>/** <a name=line.274></a>
   Return a temp placeholder string used to identify sections of fFormat that have already been interpreted.<a name=line.275></a>
   The returned string is a list of "@" characters, whose length is the same as aToken. <a name=line.276></a>
  */</span><a name=line.277></a>
  <span class='keyword'>private</span> String withCharDenotingAlreadyInterpreted(String aToken){<a name=line.278></a>
    StringBuilder result = <span class='keyword'>new</span> StringBuilder();<a name=line.279></a>
    <span class='keyword'>for</span>(<span class='keyword'>int</span> idx = <span class='literal'>1</span>; idx <= aToken.length(); ++idx){<a name=line.280></a>
      <span class='comment'>//any character that isn't interpreted, or a special regex char, will do here<a name=line.281></a>
</span>      <span class='comment'>//the fact that it's interpreted at location x is stored elsewhere;<a name=line.282></a>
</span>      <span class='comment'>//this is meant only to prevent multiple interpretations of the same text<a name=line.283></a>
</span>      result.append(<span class='literal'>"@"</span>);<a name=line.284></a>
    }<a name=line.285></a>
    <span class='keyword'>return</span> result.toString();<a name=line.286></a>
  }<a name=line.287></a>
<a name=line.288></a>
  <span class='comment'>/** Render the final output returned to the caller. */</span><a name=line.289></a>
  <span class='keyword'>private</span> String produceFinalOutput(){<a name=line.290></a>
    StringBuilder result = <span class='keyword'>new</span> StringBuilder();<a name=line.291></a>
    <span class='keyword'>int</span> idx = <span class='literal'>0</span>;<a name=line.292></a>
    <span class='keyword'>while</span> ( idx &lt; fFormat.length() ) {<a name=line.293></a>
      String letter = nextLetter(idx);<a name=line.294></a>
      InterpretedRange interpretation = getInterpretation(idx);<a name=line.295></a>
      <span class='keyword'>if</span>  (interpretation != <span class='keyword'>null</span>){<a name=line.296></a>
        result.append(interpretation.Text);<a name=line.297></a>
        idx = interpretation.End;<a name=line.298></a>
      }<a name=line.299></a>
      <span class='keyword'>else</span> {<a name=line.300></a>
        <span class='keyword'>if</span>(!ESCAPE_CHAR.equals(letter)){<a name=line.301></a>
          result.append(letter);<a name=line.302></a>
        }<a name=line.303></a>
      }<a name=line.304></a>
      ++idx;<a name=line.305></a>
    }<a name=line.306></a>
    <span class='keyword'>return</span> result.toString();<a name=line.307></a>
  }<a name=line.308></a>
<a name=line.309></a>
  <span class='keyword'>private</span> InterpretedRange getInterpretation(<span class='keyword'>int</span> aIdx){<a name=line.310></a>
    InterpretedRange result = <span class='keyword'>null</span>;<a name=line.311></a>
    <span class='keyword'>for</span>(InterpretedRange interpretedRange : fInterpretedRanges){<a name=line.312></a>
      <span class='keyword'>if</span>(interpretedRange.Start == aIdx ){<a name=line.313></a>
        result = interpretedRange;<a name=line.314></a>
      }<a name=line.315></a>
    }<a name=line.316></a>
    <span class='keyword'>return</span> result;<a name=line.317></a>
  }<a name=line.318></a>
<a name=line.319></a>
  <span class='keyword'>private</span> String nextLetter(<span class='keyword'>int</span> aIdx){<a name=line.320></a>
    <span class='keyword'>return</span> fFormat.substring(aIdx, aIdx+<span class='literal'>1</span>); <a name=line.321></a>
  }<a name=line.322></a>
  <a name=line.323></a>
  <span class='keyword'>private</span> String  interpretThe(String aCurrentToken, DateTime aDateTime){<a name=line.324></a>
    String result = EMPTY_STRING;<a name=line.325></a>
    <span class='keyword'>if</span>(YYYY.equals(aCurrentToken)) {<a name=line.326></a>
      result =  valueStr(aDateTime.getYear());<a name=line.327></a>
    }<a name=line.328></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span> (YY.equals(aCurrentToken)){<a name=line.329></a>
      result = noCentury(valueStr(aDateTime.getYear()));<a name=line.330></a>
    }<a name=line.331></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span> (MMMM.equals(aCurrentToken)){<a name=line.332></a>
      <span class='keyword'>int</span> month = aDateTime.getMonth();<a name=line.333></a>
      result = fullMonth(month);<a name=line.334></a>
    }<a name=line.335></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span> (MMM.equals(aCurrentToken)){<a name=line.336></a>
      <span class='keyword'>int</span> month = aDateTime.getMonth();<a name=line.337></a>
      result = firstThreeChars(fullMonth(month));<a name=line.338></a>
    }<a name=line.339></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span> (MM.equals(aCurrentToken)){<a name=line.340></a>
      result = addLeadingZero(valueStr(aDateTime.getMonth()));<a name=line.341></a>
    }<a name=line.342></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span> (M.equals(aCurrentToken)){<a name=line.343></a>
      result = valueStr(aDateTime.getMonth());<a name=line.344></a>
    }<a name=line.345></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span>(DD.equals(aCurrentToken)){<a name=line.346></a>
      result = addLeadingZero(valueStr(aDateTime.getDay()));<a name=line.347></a>
    }<a name=line.348></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span>(D.equals(aCurrentToken)){<a name=line.349></a>
      result = valueStr(aDateTime.getDay());<a name=line.350></a>
    }<a name=line.351></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span>(WWWW.equals(aCurrentToken)){<a name=line.352></a>
      <span class='keyword'>int</span> weekday = aDateTime.getWeekDay();<a name=line.353></a>
      result = fullWeekday(weekday);<a name=line.354></a>
    }<a name=line.355></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span>(WWW.equals(aCurrentToken)){<a name=line.356></a>
      <span class='keyword'>int</span> weekday = aDateTime.getWeekDay();<a name=line.357></a>
      result = firstThreeChars(fullWeekday(weekday));<a name=line.358></a>
    }<a name=line.359></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span>(hh.equals(aCurrentToken)){<a name=line.360></a>
      result = addLeadingZero(valueStr(aDateTime.getHour()));<a name=line.361></a>
    }<a name=line.362></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span>(h.equals(aCurrentToken)){<a name=line.363></a>
      result = valueStr(aDateTime.getHour());<a name=line.364></a>
    }<a name=line.365></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span> (h12.equals(aCurrentToken)){<a name=line.366></a>
      result = valueStr(twelveHourStyle(aDateTime.getHour()));<a name=line.367></a>
    }<a name=line.368></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span> (hh12.equals(aCurrentToken)){<a name=line.369></a>
      result = addLeadingZero(valueStr(twelveHourStyle(aDateTime.getHour())));<a name=line.370></a>
    }<a name=line.371></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span> (a.equals(aCurrentToken)){<a name=line.372></a>
      <span class='keyword'>int</span> hour = aDateTime.getHour();<a name=line.373></a>
      result = amPmIndicator(hour);<a name=line.374></a>
    }<a name=line.375></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span>(mm.equals(aCurrentToken)){<a name=line.376></a>
      result = addLeadingZero(valueStr(aDateTime.getMinute()));<a name=line.377></a>
    }<a name=line.378></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span>(m.equals(aCurrentToken)){<a name=line.379></a>
      result = valueStr(aDateTime.getMinute());<a name=line.380></a>
    }<a name=line.381></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span>(ss.equals(aCurrentToken)){<a name=line.382></a>
      result = addLeadingZero(valueStr(aDateTime.getSecond()));<a name=line.383></a>
    }<a name=line.384></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span>(s.equals(aCurrentToken)){<a name=line.385></a>
      result = valueStr(aDateTime.getSecond());<a name=line.386></a>
    }<a name=line.387></a>
    <span class='keyword'>else</span> <span class='keyword'>if</span>(aCurrentToken.startsWith(<span class='literal'>"f"</span>)){<a name=line.388></a>
      Matcher matcher = FRACTIONALS.matcher(aCurrentToken);<a name=line.389></a>
      <span class='keyword'>if</span> ( matcher.matches() ) {<a name=line.390></a>
        String nanos = nanosWithLeadingZeroes(aDateTime.getNanoseconds());<a name=line.391></a>
        <span class='keyword'>int</span> numDecimalsToShow = aCurrentToken.length();<a name=line.392></a>
        result = firstNChars(nanos, numDecimalsToShow);<a name=line.393></a>
      }<a name=line.394></a>
      <span class='keyword'>else</span> {<a name=line.395></a>
        <span class='keyword'>throw</span> <span class='keyword'>new</span> IllegalArgumentException(<span class='literal'>"Unknown token in date formatting pattern: "</span> + aCurrentToken);<a name=line.396></a>
      }<a name=line.397></a>
    }<a name=line.398></a>
    <span class='keyword'>else</span> {<a name=line.399></a>
      <span class='keyword'>throw</span> <span class='keyword'>new</span> IllegalArgumentException(<span class='literal'>"Unknown token in date formatting pattern: "</span> + aCurrentToken);<a name=line.400></a>
    }<a name=line.401></a>
    <a name=line.402></a>
    <span class='keyword'>return</span> result;<a name=line.403></a>
  }<a name=line.404></a>
  <a name=line.405></a>
  <span class='keyword'>private</span> String valueStr(Object aItem){<a name=line.406></a>
    String result = EMPTY_STRING;<a name=line.407></a>
    <span class='keyword'>if</span>(aItem != <span class='keyword'>null</span>){<a name=line.408></a>
      result = String.valueOf(aItem);<a name=line.409></a>
    }<a name=line.410></a>
    <span class='keyword'>return</span> result;<a name=line.411></a>
  }<a name=line.412></a>
<a name=line.413></a>
  <span class='keyword'>private</span> String noCentury(String aItem){<a name=line.414></a>
    String result = EMPTY_STRING;<a name=line.415></a>
    <span class='keyword'>if</span>(Util.textHasContent(aItem)){<a name=line.416></a>
      result = aItem.substring(<span class='literal'>2</span>);<a name=line.417></a>
    }<a name=line.418></a>
    <span class='keyword'>return</span> result;<a name=line.419></a>
  }<a name=line.420></a>
  <a name=line.421></a>
  <span class='keyword'>private</span> String nanosWithLeadingZeroes(Integer aNanos){<a name=line.422></a>
    String result = valueStr(aNanos);<a name=line.423></a>
    <span class='keyword'>while</span>(result.length() &lt; <span class='literal'>9</span>){<a name=line.424></a>
      result = <span class='literal'>"0"</span> + result;<a name=line.425></a>
    }<a name=line.426></a>
    <span class='keyword'>return</span> result;<a name=line.427></a>
  }<a name=line.428></a>
  <a name=line.429></a>
  <a name=line.430></a>
  <span class='comment'>/** Pad 0..9 with a leading zero. */</span><a name=line.431></a>
  <span class='keyword'>private</span> String addLeadingZero(String aTimePart){<a name=line.432></a>
    String result = aTimePart;<a name=line.433></a>
    <span class='keyword'>if</span>(Util.textHasContent(aTimePart) &amp;&amp; aTimePart.length() ==<span class='literal'>1</span>){<a name=line.434></a>
      result = <span class='literal'>"0"</span> + result;<a name=line.435></a>
    }<a name=line.436></a>
    <span class='keyword'>return</span> result;<a name=line.437></a>
  }<a name=line.438></a>
  <a name=line.439></a>
  <span class='keyword'>private</span> String firstThreeChars(String aText){<a name=line.440></a>
    String result = aText;<a name=line.441></a>
    <span class='keyword'>if</span>(Util.textHasContent(aText) &amp;&amp; aText.length()>=<span class='literal'>3</span>){<a name=line.442></a>
      result = aText.substring(<span class='literal'>0</span>,<span class='literal'>3</span>);<a name=line.443></a>
    }<a name=line.444></a>
    <span class='keyword'>return</span> result;<a name=line.445></a>
  }<a name=line.446></a>
  <a name=line.447></a>
  <span class='keyword'>private</span> String fullMonth(Integer aMonth){<a name=line.448></a>
    String result = <span class='literal'>""</span>;<a name=line.449></a>
    <span class='keyword'>if</span>(aMonth != <span class='keyword'>null</span>){<a name=line.450></a>
      <span class='keyword'>if</span>(fCustomLocalization != <span class='keyword'>null</span>){<a name=line.451></a>
        result = lookupCustomMonthFor(aMonth);<a name=line.452></a>
      }<a name=line.453></a>
      <span class='keyword'>else</span> <span class='keyword'>if</span> (fLocale != <span class='keyword'>null</span>){<a name=line.454></a>
        result = lookupMonthFor(aMonth);<a name=line.455></a>
      }<a name=line.456></a>
      <span class='keyword'>else</span> {<a name=line.457></a>
        <span class='keyword'>throw</span> <span class='keyword'>new</span> IllegalArgumentException(<span class='literal'>"Your date pattern requires either a Locale, or your own custom localizations for text:"</span> + Util.quote(fFormat)) ;<a name=line.458></a>
      }<a name=line.459></a>
    }<a name=line.460></a>
    <span class='keyword'>return</span> result;<a name=line.461></a>
  }<a name=line.462></a>
<a name=line.463></a>
  <span class='keyword'>private</span> String lookupCustomMonthFor(Integer aMonth){<a name=line.464></a>
    <span class='keyword'>return</span> fCustomLocalization.Months.get(aMonth-<span class='literal'>1</span>);<a name=line.465></a>
  }<a name=line.466></a>
  <a name=line.467></a>
  <span class='keyword'>private</span> String lookupMonthFor(Integer aMonth){<a name=line.468></a>
    String result = EMPTY_STRING;<a name=line.469></a>
    <span class='keyword'>if</span> (! fMonths.containsKey(fLocale) ){<a name=line.470></a>
      List&lt;String&gt; months = <span class='keyword'>new</span> ArrayList&lt;String&gt;();<a name=line.471></a>
      SimpleDateFormat format = <span class='keyword'>new</span> SimpleDateFormat(<span class='literal'>"MMMM"</span>, fLocale);<a name=line.472></a>
      <span class='keyword'>for</span>(<span class='keyword'>int</span> idx = Calendar.JANUARY; idx <= Calendar.DECEMBER; ++idx){<a name=line.473></a>
        Calendar firstDayOfMonth = <span class='keyword'>new</span> GregorianCalendar();<a name=line.474></a>
        firstDayOfMonth.set(Calendar.YEAR, <span class='literal'>2000</span>);<a name=line.475></a>
        firstDayOfMonth.set(Calendar.MONTH, idx);<a name=line.476></a>
        firstDayOfMonth.set(Calendar.DAY_OF_MONTH, <span class='literal'>15</span>);<a name=line.477></a>
        String monthText = format.format(firstDayOfMonth.getTime());<a name=line.478></a>
        months.add(monthText);<a name=line.479></a>
      }<a name=line.480></a>
      fMonths.put(fLocale, months);<a name=line.481></a>
    }<a name=line.482></a>
    result = fMonths.get(fLocale).get(aMonth-<span class='literal'>1</span>); <span class='comment'>//list is 0-based<a name=line.483></a>
</span>    <span class='keyword'>return</span> result;<a name=line.484></a>
  }<a name=line.485></a>
  <a name=line.486></a>
  <span class='keyword'>private</span> String fullWeekday(Integer aWeekday){<a name=line.487></a>
    String result = <span class='literal'>""</span>;<a name=line.488></a>
    <span class='keyword'>if</span>(aWeekday != <span class='keyword'>null</span>){<a name=line.489></a>
      <span class='keyword'>if</span> (fCustomLocalization != <span class='keyword'>null</span>){<a name=line.490></a>
        result = lookupCustomWeekdayFor(aWeekday);<a name=line.491></a>
      }<a name=line.492></a>
      <span class='keyword'>else</span> <span class='keyword'>if</span>(fLocale != <span class='keyword'>null</span> ){<a name=line.493></a>
        result = lookupWeekdayFor(aWeekday);<a name=line.494></a>
      }<a name=line.495></a>
      <span class='keyword'>else</span> {<a name=line.496></a>
        <span class='keyword'>throw</span> <span class='keyword'>new</span> IllegalArgumentException(<span class='literal'>"Your date pattern requires either a Locale, or your own custom localizations for text:"</span> + Util.quote(fFormat)) ;<a name=line.497></a>
      }<a name=line.498></a>
    }<a name=line.499></a>
    <span class='keyword'>return</span> result;<a name=line.500></a>
  }<a name=line.501></a>
<a name=line.502></a>
  <span class='keyword'>private</span> String lookupCustomWeekdayFor(Integer aWeekday){<a name=line.503></a>
    <span class='keyword'>return</span> fCustomLocalization.Weekdays.get(aWeekday-<span class='literal'>1</span>);<a name=line.504></a>
  }<a name=line.505></a>
  <a name=line.506></a>
  <span class='keyword'>private</span> String lookupWeekdayFor(Integer aWeekday){<a name=line.507></a>
    String result = EMPTY_STRING;<a name=line.508></a>
    <span class='keyword'>if</span> (! fWeekdays.containsKey(fLocale) ){<a name=line.509></a>
      List&lt;String&gt; weekdays = <span class='keyword'>new</span> ArrayList&lt;String&gt;();<a name=line.510></a>
      SimpleDateFormat format = <span class='keyword'>new</span> SimpleDateFormat(<span class='literal'>"EEEE"</span>, fLocale);<a name=line.511></a>
      <span class='comment'>//Feb 8, 2009..Feb 14, 2009 runs Sun..Sat<a name=line.512></a>
</span>      <span class='keyword'>for</span>(<span class='keyword'>int</span> idx = <span class='literal'>8</span>; idx <= <span class='literal'>14</span>; ++idx){<a name=line.513></a>
        Calendar firstDayOfWeek = <span class='keyword'>new</span> GregorianCalendar();<a name=line.514></a>
        firstDayOfWeek.set(Calendar.YEAR, <span class='literal'>2009</span>);<a name=line.515></a>
        firstDayOfWeek.set(Calendar.MONTH, <span class='literal'>1</span>); <span class='comment'>//month is 0-based<a name=line.516></a>
</span>        firstDayOfWeek.set(Calendar.DAY_OF_MONTH, idx);<a name=line.517></a>
        String weekdayText = format.format(firstDayOfWeek.getTime());<a name=line.518></a>
        weekdays.add(weekdayText);<a name=line.519></a>
      }<a name=line.520></a>
      fWeekdays.put(fLocale, weekdays);<a name=line.521></a>
    }<a name=line.522></a>
    result = fWeekdays.get(fLocale).get(aWeekday-<span class='literal'>1</span>); <span class='comment'>//list is 0-based<a name=line.523></a>
</span>    <span class='keyword'>return</span> result;<a name=line.524></a>
  }<a name=line.525></a>
<a name=line.526></a>
  <span class='keyword'>private</span> String firstNChars(String aText, <span class='keyword'>int</span> aN){<a name=line.527></a>
    String result = aText;<a name=line.528></a>
    <span class='keyword'>if</span>(Util.textHasContent(aText) &amp;&amp; aText.length()>=aN){<a name=line.529></a>
      result = aText.substring(<span class='literal'>0</span>,aN);<a name=line.530></a>
    }<a name=line.531></a>
    <span class='keyword'>return</span> result;<a name=line.532></a>
  }<a name=line.533></a>
<a name=line.534></a>
  <span class='comment'>/**  Coerce the hour to match the number used in the 12-hour style. */</span><a name=line.535></a>
  <span class='keyword'>private</span> Integer twelveHourStyle(Integer aHour){<a name=line.536></a>
    Integer result = aHour;<a name=line.537></a>
    <span class='keyword'>if</span>(aHour != <span class='keyword'>null</span>){<a name=line.538></a>
      <span class='keyword'>if</span> (aHour == <span class='literal'>0</span>) {<a name=line.539></a>
        result = <span class='literal'>12</span>; <span class='comment'>//eg 12:30 am<a name=line.540></a>
</span>      }<a name=line.541></a>
      <span class='keyword'>else</span> <span class='keyword'>if</span> (aHour &gt; <span class='literal'>12</span>){<a name=line.542></a>
        result = aHour - <span class='literal'>12</span>; <span class='comment'>//eg 14:00 -&gt; 2:00<a name=line.543></a>
</span>      }<a name=line.544></a>
    }<a name=line.545></a>
    <span class='keyword'>return</span> result;<a name=line.546></a>
  }<a name=line.547></a>
  <a name=line.548></a>
  <span class='keyword'>private</span> String amPmIndicator(Integer aHour){<a name=line.549></a>
    String result = <span class='literal'>""</span>;<a name=line.550></a>
    <span class='keyword'>if</span>(aHour != <span class='keyword'>null</span>){<a name=line.551></a>
      <span class='keyword'>if</span>(fCustomLocalization != <span class='keyword'>null</span>){<a name=line.552></a>
        result = lookupCustomAmPmFor(aHour);<a name=line.553></a>
      }<a name=line.554></a>
      <span class='keyword'>else</span> <span class='keyword'>if</span> (fLocale != <span class='keyword'>null</span>) {<a name=line.555></a>
        result = lookupAmPmFor(aHour);<a name=line.556></a>
      }<a name=line.557></a>
      <span class='keyword'>else</span> {<a name=line.558></a>
        <span class='keyword'>throw</span> <span class='keyword'>new</span> IllegalArgumentException(<a name=line.559></a>
          <span class='literal'>"Your date pattern requires either a Locale, or your own custom localizations for text:"</span> + Util.quote(fFormat)<a name=line.560></a>
        ) ;<a name=line.561></a>
      }<a name=line.562></a>
    }<a name=line.563></a>
    <span class='keyword'>return</span> result;<a name=line.564></a>
  }<a name=line.565></a>
    <a name=line.566></a>
  <span class='keyword'>private</span> String lookupCustomAmPmFor(Integer aHour){<a name=line.567></a>
    String result = EMPTY_STRING;<a name=line.568></a>
    <span class='keyword'>if</span>(aHour &lt; <span class='literal'>12</span> ){<a name=line.569></a>
      result = fCustomLocalization.AmPmIndicators.get(AM);<a name=line.570></a>
    }<a name=line.571></a>
    <span class='keyword'>else</span> {<a name=line.572></a>
      result = fCustomLocalization.AmPmIndicators.get(PM);<a name=line.573></a>
    }<a name=line.574></a>
    <span class='keyword'>return</span> result;<a name=line.575></a>
  }<a name=line.576></a>
    <a name=line.577></a>
  <span class='keyword'>private</span> String lookupAmPmFor(Integer aHour){<a name=line.578></a>
    String result = EMPTY_STRING;<a name=line.579></a>
    <span class='keyword'>if</span> (! fAmPm.containsKey(fLocale) ){<a name=line.580></a>
      List&lt;String&gt; indicators = <span class='keyword'>new</span> ArrayList&lt;String&gt;();<a name=line.581></a>
      indicators.add(getAmPmTextFor(<span class='literal'>6</span>));<a name=line.582></a>
      indicators.add(getAmPmTextFor(<span class='literal'>18</span>));<a name=line.583></a>
      fAmPm.put(fLocale, indicators);<a name=line.584></a>
    }<a name=line.585></a>
    <span class='keyword'>if</span> (aHour &lt; <span class='literal'>12</span> ){<a name=line.586></a>
      result = fAmPm.get(fLocale).get(AM); <a name=line.587></a>
    }<a name=line.588></a>
    <span class='keyword'>else</span> {<a name=line.589></a>
      result = fAmPm.get(fLocale).get(PM); <a name=line.590></a>
    }<a name=line.591></a>
    <span class='keyword'>return</span> result;<a name=line.592></a>
  }<a name=line.593></a>
  <a name=line.594></a>
  <span class='keyword'>private</span> String getAmPmTextFor(Integer aHour){<a name=line.595></a>
    SimpleDateFormat format = <span class='keyword'>new</span> SimpleDateFormat(<span class='literal'>"a"</span>, fLocale);<a name=line.596></a>
    Calendar someDay = <span class='keyword'>new</span> GregorianCalendar();<a name=line.597></a>
    someDay.set(Calendar.YEAR, <span class='literal'>2000</span>);<a name=line.598></a>
    someDay.set(Calendar.MONTH, <span class='literal'>6</span>);<a name=line.599></a>
    someDay.set(Calendar.DAY_OF_MONTH, <span class='literal'>15</span>);<a name=line.600></a>
    someDay.set(Calendar.HOUR_OF_DAY, aHour);<a name=line.601></a>
    <span class='keyword'>return</span> format.format(someDay.getTime());<a name=line.602></a>
  }<a name=line.603></a>
  <a name=line.604></a>
  <span class='keyword'>private</span> <span class='keyword'>void</span> validateState(){<a name=line.605></a>
    <span class='keyword'>if</span>(! Util.textHasContent(fFormat)){  <a name=line.606></a>
      <span class='keyword'>throw</span> <span class='keyword'>new</span> IllegalArgumentException(<span class='literal'>"DateTime format has no content."</span>);<a name=line.607></a>
    }<a name=line.608></a>
  }<a name=line.609></a>
}<a name=line.610></a>
 <a name=line.611></a>
</PRE><a name=line.612></a>
 </BODY><a name=line.613></a>
<HTML><a name=line.614></a>
